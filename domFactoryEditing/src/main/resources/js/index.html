<!doctype html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"><!--used to avoid fake favicon requests-->
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<!--    <script> var exports = {}; </script>&lt;!&ndash;https://stackoverflow.com/questions/42497479/uncaught-referenceerror-exports-is-not-defined-in-filed-generated-by-typescript/42510255&ndash;&gt;-->
    <!--    <script src="example/util/FactoryEditor.js"></script>-->
    <!--    <link rel="stylesheet" href="">-->
</head>
<body>
<div id="factoryEditorDiv"></div>

<script type="module">
    import {FactoryEditor} from './factoryEditing/FactoryEditor.js'
    import {AttributeEditorCreator} from "./factoryEditing/AttributeEditorCreator.js";
    import {DynamicData} from "./factoryEditing/DynamicData.js";
    import {WaitAnimation} from "./factoryEditing/WaitAnimation.js";
    import {DynamicDataDictionary} from "./factoryEditing/DynamicDataDictionary.js";
    import {GuiConfiguration} from "./factoryEditing/GuiConfiguration.js";
    import {HttpUtility} from "./factoryEditing/HttpUtility.js";
    import {View} from "./factoryEditing/View.js";

    let parentElement = document.getElementById('factoryEditorDiv');
    let view =new View();
    parentElement.appendChild(view.create());
    let waitAnimation = new WaitAnimation(parentElement,view);


    HttpUtility.get("metadata",waitAnimation,(metadataResponse) =>{
            let dynamicDataDictionary = new DynamicDataDictionary();
            dynamicDataDictionary.mapFromJson(metadataResponse.dynamicDataDictionary);

            HttpUtility.post("prepareNewFactory",null,waitAnimation,(prepareNewFactoryResponse)=> {
                    let factoryEditor = new FactoryEditor(new AttributeEditorCreator(),waitAnimation);
                    let root = new DynamicData();
                    root.mapFromJsonFromRootDynamic(prepareNewFactoryResponse.root, dynamicDataDictionary);


                    factoryEditor.addOnFactoryChange((newData)=>{
                       window.history.pushState(null, null, window.location.pathname+"#"+newData.getPath().map(factory => factory.getDisplayText()).join('/'));
                    });

                    window.onpopstate = (event)=> {
                        factoryEditor.back();
                    };

                    let guiConfiguration= new GuiConfiguration(metadataResponse.guiConfiguration, factoryEditor, root,prepareNewFactoryResponse.baseVersionId,view,waitAnimation);
                    view.setNavbar(guiConfiguration.createNavbar());

                    factoryEditor.edit(root);

                    view.show(factoryEditor);
            });

        }
    );


</script>

</body>
</html>